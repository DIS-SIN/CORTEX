[info]
prefix=pc_v2015

[extraction]
sources=[
  {
    'tsv_files': [
      {
        'file_name': 'pccfNat_AUG15_fccpNat.txt',
        'entities': {
          'pc': [
            ['pc_code', 0, 6],
          ],
          'csd': [
            ['csd_uid', 15, 7],           # integer
            ['csd_name', 22, 70],
          ],
          'cn': [
            ['cn_name', 162, 30],
            ['csd_uid', 15, 7],
          ],
          'lc': [
            ['lc_lat', 136, 11],         # float
            ['lc_lng', 147, 13],         # float
          ],
        },
        'relations': {
          'pc_TO_cn': [
            ['pc_code', 0, 6],
            ['cn_name', 162, 30],
            ['csd_uid', 15, 7],
          ],
          'csd_TO_pr': [
            ['csd_uid', 15, 7],
            ['pr_uid', 9, 2],
          ],
          'csd_TO_csd_type': [
            ['csd_uid', 15, 7],
            ['csd_type_code', 92, 3],
          ],
          'cn_TO_csd': [
            ['cn_name', 162, 30],
            ['csd_uid', 15, 7],
          ],
          'lc_TO_pc':  [
            ['lc_lat', 136, 11],
            ['lc_lng', 147, 13],
            ['pc_code', 0, 6],
          ],
          'lc_TO_cn':  [
            ['lc_lat', 136, 11],
            ['lc_lng', 147, 13],
            ['cn_name', 162, 30],
            ['csd_uid', 15, 7],
            ],
          }
        }
      ],
    }
  ]

[jotunheimr]
constraints={
  'CP_PostCode': { 'u': 'code', },
  'CP_Province': { 'u': 'uid', 'i': ['abbr', 'en_name', 'fr_name'], },
  'CP_CSD': { 'u': 'uid', 'i': ['name'], },
  'CP_CSDType': { 'u': 'code', 'i': ['name'], },
  'CP_Community': { 'c': ['name', 'csd_uid'], 'i': ['name'], },
  'CP_Location': { 'p': ['lat', 'lng'], },
  }
credentials={
  'host': 'jotunheimr:7687',
  'username': 'neo4j',
  'password': '##dis@da2019##',
  'direct_host': 'localhost:7687',
  'container_name': 'jotunheimr'
  }
topics={
  'pc': 'MERGE (n:CP_PostCode {code: event.pc_code})',
  'pr': 'MERGE (n:CP_Province {uid: event.pr_uid}) SET n.abbr = event.pr_abbr, n.en_name = event.pr_en_name, n.fr_name = event.pr_fr_name',
  'csd': 'MERGE (n:CP_CSD {uid: TOINTEGER(event.csd_uid)}) SET n.name = event.csd_name',
  'csd_type': 'MERGE (n:CP_CSDType {code: event.csd_type_code}) SET n.name = event.csd_type_name',
  'cn': 'MERGE (n:CP_Community {name: event.cn_name, csd_uid: TOINTEGER(event.csd_uid)})',
  'lc': "MERGE (n:CP_Location {point: POINT({latitude: TOFLOAT(event.lc_lat), longitude: TOFLOAT(event.lc_lng), crs: 'WGS-84'})})",
  'pc_TO_cn': "MATCH (s:CP_PostCode {code: event.pc_code}), (e:CP_Community {name: event.cn_name, csd_uid: TOINTEGER(event.csd_uid)}) WITH s, e MERGE (s)-[:PC_IN_CN]->(e)",
  'csd_TO_pr': "MATCH (s:CP_CSD {uid: TOINTEGER(event.csd_uid)}), (e:CP_Province {uid: event.pr_uid}) WITH s, e MERGE (s)-[:CSD_IN_PR]->(e)",
  'csd_TO_csd_type': "MATCH (s:CP_CSD {uid: TOINTEGER(event.csd_uid)}), (e:CP_CSDType {code: event.csd_type_code}) WITH s, e MERGE (s)-[:CSD_TYPE]->(e)",
  'cn_TO_csd': "MATCH (s:CP_Community {name: event.cn_name, csd_uid: TOINTEGER(event.csd_uid)}), (e:CP_CSD {uid: TOINTEGER(event.csd_uid)}) WITH s, e MERGE (s)-[:CN_IN_CSD]->(e)",
  'lc_TO_pc': "MATCH (s:CP_Location {point: POINT({latitude: TOFLOAT(event.lc_lat), longitude: TOFLOAT(event.lc_lng), crs: 'WGS-84'})}), (e:CP_PostCode {code: event.pc_code}) WITH s, e MERGE (s)-[:LC_AT_PC]->(e)",
  'lc_TO_cn': "MATCH (s:CP_Location {point: POINT({latitude: TOFLOAT(event.lc_lat), longitude: TOFLOAT(event.lc_lng), crs: 'WGS-84'})}), (e:CP_Community {name: event.cn_name, csd_uid: TOINTEGER(event.csd_uid)}) WITH s, e MERGE (s)-[:LC_AT_CN]->(e)",
  }

[yggdrasil]
conf={
  'broker': 'localhost:9092',
  'schema_registry': 'http://localhost:8081',
  'connect': 'localhost:8083',
  }

[avro]
schema={
  "namespace": "ca.gov.cp.pc.v2015",
  "type": "record",
  "name": "entity",
  "fields": [
    {"name": "pc_code", "type": ["null", "string"]},
    {"name": "pr_uid", "type": ["null", "string"]},
    {"name": "pr_abbr", "type": ["null", "string"]},
  	{"name": "pr_en_name", "type": ["null", "string"]},
  	{"name": "pr_fr_name", "type": ["null", "string"]},
    {"name": "csd_uid", "type": ["null", "string"]},
    {"name": "csd_name", "type": ["null", "string"]},
    {"name": "csd_type_code", "type": ["null", "string"]},
    {"name": "csd_type_name", "type": ["null", "string"]},
    {"name": "cn_name", "type": ["null", "string"]},
    {"name": "lc_lat", "type": ["null", "string"]},
    {"name": "lc_lng", "type": ["null", "string"]}
  ]
  }
